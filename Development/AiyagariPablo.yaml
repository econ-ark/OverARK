block:
    name: consumption-saving block in the style of Aiyagari (1994)

    label: aiyagariCS

    symbols:
        states: [a, ePrev]
        distributions: [F]
        parameters: [alpha, L, K, delta, B, rho, sigma]
        controls: [i]

    definitions:
        c: m - i

    dynamics:
        - s ~ F
        - e = rho*ePrev + sigma*s
        - b = (1+r)*a
        - y = w*exp(e)
        - m = b + y
        - i ! (m, e) | [-B <= i, i <= m]

    felicity:
        log(c)

    calibration:
        B: 1.5
        alpha: 0.36
        L: 1.0
        K: 40.0
        delta: 0.025
        rho: 0.95
        sigma: 0.06
        r: alpha*(L/K)**(1-alpha) - delta
        w: (1-alpha)*(K/L)**(alpha)
        F: !Normal


block:
    name: entry into Aiyagari (1994) model

    label: initializer

    dynamics:
        - start
        - a = 0
        - ePrev = 0


connector:
    label: time_loop

    twist:
        e: ePrev
        i: a

    tick: True


group:
    label: aiyagari_model

    content:
        - link(initializer, aiyagariCS)
        - link(aiyagariCS, time_loop, aiyagariCS)


agent:
    label: aiyagari_consumer

    model: aiyagari_model

    discount: 0.95

